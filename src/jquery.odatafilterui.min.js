(function(e){var t;var n=new ko.nativeTemplateEngine;n.makeTemplateSource=function(e){return{text:function(){return t}}};ko.bindingHandlers["fieldTemplate"]={update:function(e,t,r,i,s){var o=ko.utils.unwrapObservable(t());o.templateEngine=n;ko.renderTemplate(null,s.createChildContext(o.data),o,e,"replaceNode")}};e.fn.oDataFilterUI=function(n){var r=e.extend({Fields:[],CustomTypes:[],fieldNameModifier:function(e){return e}},n);this.attr("type","hidden");var i=this.wrap(e("<div>")).parent();var s=e("<span>").html("There are currently no filters applied").prependTo(i);s.before("<!-- ko if: !FilterRows() || FilterRows().length == 0 -->");s.after("<!-- /ko -->");var o=e("<div>",{"data-bind":"fieldTemplate: { data: $root }"}).insertAfter(this);var u=e("<div>",{"data-bind":"foreach: FilterRows"});var a=e("<ol>").appendTo(u);var f=e("<select>",{"class":"filterField","data-bind":"value: Field, options: $parent.Fields, optionsText: 'text'"}).appendTo(a).wrap(e("<li>")).parent();f.before("<!-- ko if: $parent.Fields -->");f.after("<!-- /ko -->");var l=e("<select>",{"class":"filterOperator","data-bind":"value: Operator, options: OperatorsList, optionsText: 'text', optionsValue: 'value'"}).appendTo(a).wrap(e("<li>"));var c=e("<input>",{"class":"filterValue",type:"text","data-bind":"value: Value"}).appendTo(a).wrap(e("<li>")).parent();c.before("<!-- ko if: (Field() && Field().type == 'string') -->");c.after("<!-- /ko -->");var h=e("<input>",{"class":"filterValue",type:"number","data-bind":"value: Value"}).appendTo(a).wrap(e("<li>")).parent();h.before("<!-- ko if: Field() && Field().type == 'int' -->");h.after("<!-- /ko -->");var p=e("<input>",{"class":"filterValue",type:"datetime-local","data-bind":"value: Value"}).appendTo(a).wrap(e("<li>")).parent();p.before("<!-- ko if: Field() && Field().type == 'datetime' -->");p.after("<!-- /ko -->");var d=e("<input>",{"class":"filterValue",type:"checkbox","data-bind":"checked: Value"}).appendTo(a).wrap(e("<li>")).parent();d.before("<!-- ko if: Field() && Field().type == 'bool' -->");d.after("<!-- /ko -->");var v=e("<div>",{"data-bind":"fieldTemplate: { data: $data }"}).appendTo(a).wrap(e("<li>")).parent();v.before("<!-- ko if: FieldIsArrayType() -->");v.after("<!-- /ko -->");var m=e("<a>",{"class":"filterRemove",href:"#","data-bind":"click: $parent.removeFilter"}).html("remove").appendTo(a).wrap(e("<li>")).parent();m.before("<!-- ko if: $parent.Fields -->");m.after("<!-- /ko -->");var g=e("<a>",{"class":"addAnother",href:"#","data-bind":"click: addAnother"}).html("add").appendTo(i);t=u.wrap(e("<div>")).parent().html();var y=function(){var e=ko.observable();var t=ko.observable();var n=ko.observable();var i=ko.computed(function(){return e().value},null,{deferEvaluation:true});var s=ko.computed(function(){return e().type.indexOf("array[")>=0},null,{deferEvaluation:true});var o=ko.computed(function(){var t=[{text:"Equals",value:"eq"},{text:"Not equals",value:"ne"}];var n=e()?e().type:"string";switch(n){case"int":case"datetime":t.push({text:"Greater than",value:"gt"});t.push({text:"Greater than or equals",value:"ge"});t.push({text:"Less than",value:"lt"});t.push({text:"Less than or equals",value:"le"});break;case"string":t.push({text:"Starts With",value:"startswith"});t.push({text:"Ends With",value:"endswith"});t.push({text:"Contains",value:"contains"});break;default:if(n.indexOf("array[")>=0){t=[];t.push({text:"Any",value:"any"});t.push({text:"All",value:"all"});t.push({text:"Count",value:"count"})}break}return t},null,{deferEvaluation:true});var u=ko.computed(function(){var n=[];var i=e()?e().type:"string";t(null);if(e().type.indexOf("array[")>=0){var s=e().type.replace("array[","").replace("]","");var o=ko.utils.arrayFirst(r.CustomTypes,function(e){return e.name==s});var u=y();var a=t()?t():"any";var f=s;if(o){if(o.fields&&o.fields.length==1){var l=o.fields[0];switch(a){case"count":u.Field({text:"count",value:e().value+"/count()",type:"int"});break;case"any":case"all":u.Field({text:"value",value:"value/"+l.value,type:l.type})}n.push(u);return n}}switch(a){case"count":u.Field({text:"count",value:e().value+"/count()",type:"int"});break;case"any":case"all":u.Field({text:"value",value:"value",type:f})}n.push(u)}return n},null,{deferEvaluation:true});var a={};a.Field=e;a.FieldName=i;a.FieldIsArrayType=s;a.Operator=t;a.Value=n;a.OperatorsList=o;a.FilterRows=u;return a};var b=ko.observableArray([]);var w=ko.observableArray(r.Fields);var E=function(e){if(b().length>0){b.remove(e)}};var g=function(){b.push(y())};var S=function(e,t){t=typeof t!=="undefined"?t:true;var n=t?r.fieldNameModifier(e.FieldName()):e.FieldName();var i=n+" "+e.Operator()+" ";switch(e.Field().type){case"string":var s="'"+(e.Value()?e.Value():"")+"'";switch(e.Operator()){case"startswith":i="startswith("+n+","+s+")";break;case"endswith":i="endswith("+n+","+s+")";break;case"contains":i="substringof("+s+","+n+")";break;default:i=i+"'"+(e.Value()?e.Value():"")+"'"}return i;case"int":i=i+(e.Value()?e.Value():0);return i;case"datetime":i=i+"datetime'"+(e.Value()?e.Value():"1753-01-01T00:00")+"'";return i;case"bool":i=i+(e.Value()?e.Value():false);return i;default:if(e.Field().type.indexOf("array[")>=0){var o=e.Field().type.replace("array[","").replace("]","");switch(e.Operator()){case"any":case"all":var u=n+"/"+e.Operator()+"(value: ";var a=[];for(var f in e.FilterRows()){var l=e.FilterRows()[f];var i=S(l,false);a.push(i)}if(a.length>0){u=u+a.join(" and ")}u=u+")";return u;case"count":var u;var a=[];for(var f in e.FilterRows()){var l=e.FilterRows()[f];var i=S(l);a.push(i)}if(a.length>0){u=a.join(" and ")}return u}}break}};var x=ko.computed(function(){var e=[];for(var t in b()){var n=b()[t];var r=S(n);e.push(r)}if(e.length>0){return"$filter="+e.join(" and ")}return""},null,{deferEvaluation:true});if(r.Model){this.Model=r.Model}else{this.Model={};this.Model.FilterRows=b;this.Model.Fields=w;this.Model.removeFilter=E;this.Model.addAnother=g;this.Model.getODataFilter=x}ko.applyBindings(this.Model,i.get(0));return this}})(jQuery)