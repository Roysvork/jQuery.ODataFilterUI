(function(e){var t;var n=new ko.nativeTemplateEngine;n.makeTemplateSource=function(e){return{text:function(){return t}}};ko.bindingHandlers["fieldTemplate"]={update:function(e,t,r,i,s){var o=ko.utils.unwrapObservable(t());o.templateEngine=n;ko.renderTemplate(null,s.createChildContext(o.data),o,e,"replaceNode")}};e.fn.oDataFilterUI=function(n){this.attr("type","hidden");var r=this.wrap(e("<div>")).parent();var i=e("<span>").html("There are currently no filters applied").prependTo(r);i.before("<!-- ko if: !FilterRows() || FilterRows().length == 0 -->");i.after("<!-- /ko -->");var s=e("<div>",{"data-bind":"fieldTemplate: { data: $root }"}).insertAfter(this);var o=e("<div>",{"data-bind":"foreach: FilterRows"});var u=e("<ol>").appendTo(o);var a=e("<select>",{"class":"filterField","data-bind":"value: Field, options: $parent.Fields, optionsText: 'text'"}).appendTo(u).wrap(e("<li>")).parent();a.before("<!-- ko if: $parent.Fields -->");a.after("<!-- /ko -->");var f=e("<select>",{"class":"filterOperator","data-bind":"value: Operator, options: OperatorsList, optionsText: 'text', optionsValue: 'value'"}).appendTo(u).wrap(e("<li>"));var l=e("<input>",{"class":"filterValue",type:"text","data-bind":"value: Value"}).appendTo(u).wrap(e("<li>")).parent();l.before("<!-- ko if: (Field() && Field().type == 'string') -->");l.after("<!-- /ko -->");var c=e("<input>",{"class":"filterValue",type:"number","data-bind":"value: Value"}).appendTo(u).wrap(e("<li>")).parent();c.before("<!-- ko if: Field() && Field().type == 'int' -->");c.after("<!-- /ko -->");var h=e("<input>",{"class":"filterValue",type:"datetime-local","data-bind":"value: Value"}).appendTo(u).wrap(e("<li>")).parent();h.before("<!-- ko if: Field() && Field().type == 'datetime' -->");h.after("<!-- /ko -->");var p=e("<input>",{"class":"filterValue",type:"checkbox","data-bind":"checked: Value"}).appendTo(u).wrap(e("<li>")).parent();p.before("<!-- ko if: Field() && Field().type == 'bool' -->");p.after("<!-- /ko -->");var d=e("<div>",{"data-bind":"fieldTemplate: { data: $data }"}).appendTo(u).wrap(e("<li>")).parent();d.before("<!-- ko if: Field() && Field().type == 'array[string]' -->");d.after("<!-- /ko -->");var v=e("<a>",{"class":"filterRemove",href:"#","data-bind":"click: $parent.removeFilter"}).html("remove").appendTo(u).wrap(e("<li>")).parent();v.before("<!-- ko if: $parent.Fields -->");v.after("<!-- /ko -->");var m=e("<a>",{"class":"addAnother",href:"#","data-bind":"click: addAnother"}).html("add").appendTo(r);t=o.wrap(e("<div>")).parent().html();var g=function(){var e=ko.observable();var t=ko.observable();var n=ko.observable();var r=ko.computed(function(){return e().value},null,{deferEvaluation:true});var i=ko.computed(function(){var t=[{text:"Equals",value:"eq"},{text:"Not equals",value:"ne"}];var n=e()?e().type:"string";switch(n){case"int":case"datetime":t.push({text:"Greater than",value:"gt"});t.push({text:"Greater than or equals",value:"ge"});t.push({text:"Less than",value:"lt"});t.push({text:"Less than or equals",value:"le"});break;case"string":t.push({text:"Starts With",value:"startswith"});t.push({text:"Ends With",value:"endswith"});t.push({text:"Contains",value:"contains"});break;case"array[string]":t=[];t.push({text:"Any",value:"any"});t.push({text:"All",value:"all"});t.push({text:"Count",value:"count"});break}return t},null,{deferEvaluation:true});var s=ko.computed(function(){var n=[];var r=e()?e().type:"string";t(null);if(r=="array[string]"){var i=g();var s=t()?t():"any";switch(s){case"count":i.Field({text:"count",value:e().value+"/count()",type:"int"});break;case"any":case"all":i.Field({text:"value",value:"value",type:"string"})}n.push(i)}return n},null,{deferEvaluation:true});var o={};o.Field=e;o.FieldName=r;o.Operator=t;o.Value=n;o.OperatorsList=i;o.FilterRows=s;return o};var y=e.extend({Fields:[],fieldNameModifier:function(e){return e}},n);var b=ko.observableArray([]);var w=ko.observableArray(y.Fields);var E=function(e){if(b().length>0){b.remove(e)}};var m=function(){b.push(g())};var S=function(e){var t=y.fieldNameModifier(e.FieldName());var n=t+" "+e.Operator()+" ";switch(e.Field().type){case"string":var r="'"+(e.Value()?e.Value():"")+"'";switch(e.Operator()){case"startswith":n="startswith("+t+","+r+")";break;case"endswith":n="endswith("+t+","+r+")";break;case"contains":n="substringof("+r+","+t+")";break;default:n=n+"'"+(e.Value()?e.Value():"")+"'"}return n;case"int":n=n+(e.Value()?e.Value():0);return n;case"datetime":n=n+"datetime'"+(e.Value()?e.Value():"1753-01-01T00:00")+"'";return n;case"bool":n=n+(e.Value()?e.Value():false);return n;case"array[string]":switch(e.Operator()){case"any":case"all":var i=t+"/"+e.Operator()+"(value: ";var s=[];for(var o in e.FilterRows()){var u=e.FilterRows()[o];var n=S(u);s.push(n)}if(s.length>0){i=i+s.join(" and ")}i=i+")";return i;case"count":var i;var s=[];for(var o in e.FilterRows()){var u=e.FilterRows()[o];var n=S(u);s.push(n)}if(s.length>0){i=s.join(" and ")}return i}break}};var x=ko.computed(function(){var e=[];for(var t in b()){var n=b()[t];var r=S(n);e.push(r)}if(e.length>0){return"$filter="+e.join(" and ")}return""},null,{deferEvaluation:true});if(y.Model){this.Model=y.Model}else{this.Model={};this.Model.FilterRows=b;this.Model.Fields=w;this.Model.removeFilter=E;this.Model.addAnother=m;this.Model.getODataFilter=x}ko.applyBindings(this.Model,r.get(0));return this}})(jQuery)